<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>detail</title>
    <!-- jQuery-->
    <script src="js/jquery.min.js"></script>
    <script src="js/angular.js"></script>
    <script src="js/angular-route.js"></script>
    <!-- Custom Theme files -->
    <!--theme-style-->
    <link href="css/style_cc.css" rel="stylesheet" type="text/css" media="all" />
    <link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
    <!--//theme-style-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Kappe Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template,
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />
    <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
    <!--fonts-->
    <!--<link href='http://fonts.useso.com/css?family=Roboto:400,300,100,500,700,900' rel='stylesheet' type='text/css'>-->
    <!--//fonts-->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Untitled Document</title>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="js/echarts.js"></script>
</head>
<body>
<div class="header">
    <div class="header-left">
        <div class="logo">
            <a ng-click="check_out()">登出</a>
        </div>
        <div class="top-nav">
            <ul >
                <li><b class="white"></b></li>

                <li ><a href="index_data2.html" >大数据展示</a ></li>
                <li><a href="news.html" class="black" > 新闻资讯</a ></li>
                <li><a href="ranking.html" class="black1"> 龙虎榜</a ></li>
                <li><a href="work.html" class="black2" > 个人主页</a ></li>
                <li>

                </li>

                <div class="your-top">
                    <form method="get" id="search_form" onkeypress="form_query()" action="/detail.html">
                        <div class="cf">
                            <label class="search-bar">
                                <input id="keyword" placeholder="请输入股票代码" name="code" type="text" value="" class="input-search" >
                                <a id="search" class="btn-search">
                                    <i class="icon-search"></i>
                                </a>
                                <a href="javascript:;" class="btn-more"></a>
                            </label>
                        </div>
                    </form>

                    <div class="clear"> </div>
                </div>

            </ul>
        </div>
    </div>
    <!---->
    <div class="content" ng-app="myApp" ng-controller="siteCtrl">
        <div class="work">
            <p class="heat-map-title" >&nbsp;&nbsp;&nbsp;{{stockname.name}}({{code}})<span class="heat-map-title2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;加入自选股</span></p>
            <div class="work-top">

                <!--<a href="http://i.finance.sina.com.cn/zixuan,stock" target="_blank"  id="holdStatus" suda-uatrack="key=pc_hq_callup&value=hs">加入自选股</a>
              <script type="text/javascript">
                  if(/\((iPhone|iPad|iPod)/i.test(navigator.userAgent))
                  {
                      document.getElementById('getShortcut').style.display = 'none';
                  }
              </script>-->

                <div class="test">
                    <!-- <div class="price_time">
                        <div class="price clearfix" id="trading">
                            <div class="change">
                                <div id="change" class="@UD_change@">@change@</div>
                                <div id="changeP" class="@UD_change@">@changeP@</div>
                            </div>
                            <div id="arrow" class="arrow arrow_@UD_change@"></div>
                            <div id="price" class="@UD_change@">@now@</div>
                            <div class="ud_limit" id="ud_limie">
                                <div>涨停：@up_limit@</div>
                                <div>跌停：@down_limit@</div>
                            </div>
                        </div>
                    </div>-->
                    <div class="test-top">
                        <div class="blog-in">
                            <h5>{{datarealtime.close_value}}</h5>
                            <p>涨停：@up_limit@&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;跌停：@down_limit@</p>

                            <ul class="date">
                                <li><span><i class="date-in"></i>{{datarealtime.trading_day}}</span></li>
                            </ul>
                            <ul class="date">

                            </ul>
                        </div>


                        <table border="0" cellpadding="0" cellspacing="0">
                            <colgroup>
                                <col width="100" />
                                <col width="70" />
                                <col width="100" />
                                <col width="70" />

                            </colgroup>
                            <tbody>
                            <tr>
                                <th>今&nbsp;&nbsp;开：</th>
                                <td class="@UD_open_color@">{{datarealtime.open_value}}</td>
                                <th>昨&nbsp;&nbsp;收：</th>
                                <td>{{datarealtime.close_value}}</td>
                            </tr>
                            <tr>

                                <th>最&nbsp;&nbsp;高：</th>
                                <td class="@UD_high_color@">{{datarealtime.high_value}}</td>
                                <th>最&nbsp;&nbsp;低：</th>
                                <td class="@UD_low_color@">{{datarealtime.low_value}}</td>
                            </tr>
                            <tr>
                                <th>振&nbsp;&nbsp;幅：</th>
                                <td>{{datarealtime.p_change}}</td>

                                <th>换手率：</th>
                                <td>{{datarealtime.turnoverratio}}</td>
                            </tr>
                            <tr>
                                <th>成交额：</th>
                                <td>{{datarealtime.volumn_value}}</td>
                                <th>成交量：</th>
                                <td>{{datarealtime.amount}}</td>

                            </tr>
                            <tr>
                                <th>市净率：</th>
                                <td>{{datarealtime.pb}}</td>
                                <th>市盈率<sup>TTM</sup>：</th>
                                <td>{{datarealtime.per}}</td>
                            </tr>
                            <tr>
                                <th>流通市值：</th>
                                <td>{{datarealtime.nmc}}</td>
                                <th>总市值：</th>
                                <td>{{datarealtime.mktcap}}</td>

                            </tr>
                            </tbody>
                        </table>

                        <br/>
                    </div>
                </div>

                <!--<script type="text/javascript">hq.init();</script>&ndash;&gt;-->
                <div id="main" style="width: 360px;height:240px;"></div>
            </div>
            <div class="work-in">

                <div class="test">
                    <div class="test-in">

                        <h4 class="author" >&nbsp;&nbsp;&nbsp;股吧论坛</h4>
                        <div class="clear"> </div>
                    </div>
                    <div class="blog-in">
                        <li  ng-repeat="x in news">
                            [<span><a>点击量</a>{{x.click}}</span>]
                            <a  href="{{x.url}}" target="_blank">{{x.name}}</a></li>

                        <ul class="date">
                            <li><span><a href="http://vip.stock.finance.sina.com.cn/corp/go.php/vCB_AllNewsStock/symbol/sh601318.phtml" target="_blank"><i ></i>更多</a></span></li>
                        </ul>
                    </div>
                    <br/>

                    <div class="services">
                        <div class="test-in">
                            <h4 class="author">&nbsp;&nbsp;&nbsp;研究报告</h4>
                            <div class="clear"> </div>
                        </div>

                        <div class="blog-in">
                            <li  ng-repeat="y in research">
                                [<span><a>发布日期</a>{{y.date}}</span>]
                                <a  href="{{y.url}}" target="_blank">{{y.title}}</a></li>
                            <ul class="date">
                                <li><span><a href="http://vip.stock.finance.sina.com.cn/q/go.php/vReport_List/kind/search/index.phtml?symbol=601318&t1=all" target="_blank"><i ></i>更多</a></span></li>

                            </ul>
                        </div>

                    </div></div></div>
            <div class="clear"> </div>
        </div>
    </div>
    <div class="clear"> </div>

</div>

</body>

<script>
    function getQueryStringArgs(){
        var qs = (location.search.length>0?location.search.substring(1):"");
        var args = {};
        var items = qs.length?qs.split("&"):[];
        var item = null;
        var name = null;
        var value = null;
        len = items.length;
        for (var i = 0; i < len; i++) {
            item = items[i].split("=");
            name = decodeURIComponent(item[0]);
            value = decodeURIComponent(item[1]);
            if (name.length) {
                args[name] = value;
            }
        }
        return args;
    }
    var args = getQueryStringArgs();
    var code = args["code"];
    var app = angular.module('myApp', []);
    app.controller('siteCtrl', function($scope, $http) {
        $scope.code = code;
        $http.get("http://localhost:8080/stock/name?code=" + code)
            .then(function (response) {
                if (response.data === 400)
                    window.location.href =  "login.html";
                $scope.stockname = response.data;
            });
        $http.get("http://localhost:8080/news/code?code=" + code)
            .then(function (response) {
                if (response.data === 400)
                    window.location.href =  "login.html";
                $scope.news = response.data;
            });
        $http.get("http://localhost:8080/research/code?code=" + code)
            .then(function (response) {
                if (response.data === 400)
                    window.location.href =  "login.html";
                $scope.research = response.data;
            });
        $http.get("http://localhost:8080/stock/brief?code=" + code)
            .then(function (response) {
                if (response.data === 400)
                    window.location.href =  "login.html";
                $scope.datarealtime = response.data;
            });
        $http.get("http://localhost:8080/stock/history?code=" + code)
            .then(function (response) {
                if (response.data === 400)
                    window.location.href =  "login.html";
                //绘图
                var upColor = '#00da3c';
                var downColor = '#ec0000';
                var myChart = echarts.init(document.getElementById('main'));
                var data = splitData(response.data);
                myChart.setOption(option = {
                    backgroundColor: '#fff',
                    animation: false,
                    legend: {
                        bottom: 10,
                        left: 'center',
                        data: ['Dow-Jones index', 'MA5', 'MA10', 'MA20', 'MA30']
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross'
                        },
                        backgroundColor: 'rgba(245, 245, 245, 0.8)',
                        borderWidth: 1,
                        borderColor: '#ccc',
                        padding: 10,
                        textStyle: {
                            color: '#000'
                        },
                        position: function (pos, params, el, elRect, size) {
                            var obj = {top: 10};
                            obj[['left', 'right'][+(pos[0] < size.viewSize[0] / 2)]] = 30;
                            return obj;
                        }
                        // extraCssText: 'width: 170px'
                    },
                    axisPointer: {
                        link: {xAxisIndex: 'all'},
                        label: {
                            backgroundColor: '#777'
                        }
                    },
                    toolbox: {
                        feature: {
                            dataZoom: {
                                yAxisIndex: false
                            },
                            brush: {
                                type: ['lineX', 'clear']
                            }
                        }
                    },
                    brush: {
                        xAxisIndex: 'all',
                        brushLink: 'all',
                        outOfBrush: {
                            colorAlpha: 0.1
                        }
                    },
                    visualMap: {
                        show: false,
                        seriesIndex: 5,
                        dimension: 2,
                        pieces: [{
                            value: 1,
                            color: downColor
                        }, {
                            value: -1,
                            color: upColor
                        }]
                    },
                    grid: [
                        {
                            left: '10%',
                            right: '8%',
                            height: '50%'
                        },
                        {
                            left: '10%',
                            right: '8%',
                            top: '63%',
                            height: '16%'
                        }
                    ],
                    xAxis: [
                        {
                            type: 'category',
                            data: data.categoryData,
                            scale: true,
                            boundaryGap : false,
                            axisLine: {onZero: false},
                            splitLine: {show: false},
                            splitNumber: 20,
                            min: 'dataMin',
                            max: 'dataMax',
                            axisPointer: {
                                z: 100
                            }
                        },
                        {
                            type: 'category',
                            gridIndex: 1,
                            data: data.categoryData,
                            scale: true,
                            boundaryGap : false,
                            axisLine: {onZero: false},
                            axisTick: {show: false},
                            splitLine: {show: false},
                            axisLabel: {show: false},
                            splitNumber: 20,
                            min: 'dataMin',
                            max: 'dataMax'
                            // axisPointer: {
                            //     label: {
                            //         formatter: function (params) {
                            //             var seriesValue = (params.seriesData[0] || {}).value;
                            //             return params.value
                            //             + (seriesValue != null
                            //                 ? '\n' + echarts.format.addCommas(seriesValue)
                            //                 : ''
                            //             );
                            //         }
                            //     }
                            // }
                        }
                    ],
                    yAxis: [
                        {
                            scale: true,
                            splitArea: {
                                show: true
                            }
                        },
                        {
                            scale: true,
                            gridIndex: 1,
                            splitNumber: 2,
                            axisLabel: {show: false},
                            axisLine: {show: false},
                            axisTick: {show: false},
                            splitLine: {show: false}
                        }
                    ],
                    dataZoom: [
                        {
                            type: 'inside',
                            xAxisIndex: [0, 1],
                            start: 98,
                            end: 100
                        },
                        {
                            show: true,
                            xAxisIndex: [0, 1],
                            type: 'slider',
                            top: '85%',
                            start: 98,
                            end: 100
                        }
                    ],
                    series: [
                        {
                            name: 'Dow-Jones index',
                            type: 'candlestick',
                            data: data.values,
                            itemStyle: {
                                normal: {
                                    color: upColor,
                                    color0: downColor,
                                    borderColor: null,
                                    borderColor0: null
                                }
                            },
                            tooltip: {
                                formatter: function (param) {
                                    param = param[0];
                                    return [
                                        'Date: ' + param.name + '<hr size=1 style="margin: 3px 0">',
                                        'Open: ' + param.data[0] + '<br/>',
                                        'Close: ' + param.data[1] + '<br/>',
                                        'Lowest: ' + param.data[2] + '<br/>',
                                        'Highest: ' + param.data[3] + '<br/>'
                                    ].join('');
                                }
                            }
                        },
                        {
                            name: 'MA5',
                            type: 'line',
                            data: calculateMA(5, data),
                            smooth: true,
                            lineStyle: {
                                normal: {opacity: 0.5}
                            }
                        },
                        {
                            name: 'MA10',
                            type: 'line',
                            data: calculateMA(10, data),
                            smooth: true,
                            lineStyle: {
                                normal: {opacity: 0.5}
                            }
                        },
                        {
                            name: 'MA20',
                            type: 'line',
                            data: calculateMA(20, data),
                            smooth: true,
                            lineStyle: {
                                normal: {opacity: 0.5}
                            }
                        },
                        {
                            name: 'MA30',
                            type: 'line',
                            data: calculateMA(30, data),
                            smooth: true,
                            lineStyle: {
                                normal: {opacity: 0.5}
                            }
                        },
                        {
                            name: 'Volume',
                            type: 'bar',
                            xAxisIndex: 1,
                            yAxisIndex: 1,
                            data: data.volumes
                        }
                    ]
                }, true);
                myChart.dispatchAction({
                    type: 'brush',
                    areas: [
                        {
                            brushType: 'lineX',
                            coordRange: ['2016-06-02', '2016-06-20'],
                            xAxisIndex: 0
                        }
                    ]
                });
            });
    });
    function splitData(rawData) {
        var categoryData = [];
        var values = [];
        var volumes = [];
        for (var i = 0; i < rawData.length; i++) {
            categoryData.push(rawData[i].splice(0, 1)[0]);
            values.push(rawData[i]);
            volumes.push([i, rawData[i][4], rawData[i][0] > rawData[i][1] ? 1 : -1]);
        }
        return {
            categoryData: categoryData,
            values: values,
            volumes: volumes
        };
    }
    function calculateMA(dayCount, data) {
        var result = [];
        for (var i = 0, len = data.values.length; i < len; i++) {
            if (i < dayCount) {
                result.push('-');
                continue;
            }
            var sum = 0;
            for (var j = 0; j < dayCount; j++) {
                sum += data.values[i - j][1];
            }
            result.push(+(sum / dayCount).toFixed(3));
        }
        return result;
    }
    // myChart.on('brushSelected', renderBrushed);
    // function renderBrushed(params) {
    //     var sum = 0;
    //     var min = Infinity;
    //     var max = -Infinity;
    //     var countBySeries = [];
    //     var brushComponent = params.brushComponents[0];
    //     var rawIndices = brushComponent.series[0].rawIndices;
    //     for (var i = 0; i < rawIndices.length; i++) {
    //         var val = data.values[rawIndices[i]][1];
    //         sum += val;
    //         min = Math.min(val, min);
    //         max = Math.max(val, max);
    //     }
    //     panel.innerHTML = [
    //         '<h3>STATISTICS:</h3>',
    //         'SUM of open: ' + (sum / rawIndices.length).toFixed(4) + '<br>',
    //         'MIN of open: ' + min.toFixed(4) + '<br>',
    //         'MAX of open: ' + max.toFixed(4) + '<br>'
    //     ].join(' ');
    // }
</script>
</html>


</html>
